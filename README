# Rainfall effects on the 2015 Juba cholera epidemic


## TODO
  - The coefficient are per year. Find by hand some good coeffs and run for artibonite

## Data

1. `cases_data.csv`: reported cholera cases for 2014-2015 in Juba
2. `rain_data.csv`: remote sensing estimate of daily rainfall (TRMM data)
3. `input_parameters.yaml`: fixed parameters for the SIRB model in [YAML](http://yaml.org/) format 

## Code

1. `pomp_cholera_juba.R`: build the [POMP](https://kingaa.github.io/pomp/) object containing data and code for simulation
2. `run_mif_cholera.R`: fit the models using [multiple iterated filtering](http://www.pnas.org/content/112/3/719)
3. `analysis_mif_runs.R`: code to produce all the figures of the paper, maybe the most usefull is the one to simulate the stochastic model in the "Compare outputs" section


## Package to install

  install.packages(c("tictoc", "pomp","tidyverse","magrittr","ggthemes","GGally","foreach","itertools","lubridate","dplyr","purrr","readr","stringr","tibble","doMC","doSNOW" ) , dependencies=TRUE)
  options(show.error.locations=TRUE)
  options(error=recover)

Time:

cholera_Np <- 1000
cholera_Nmif <- 1
cholera_Ninit_param <- n_runs
cholera_NpLL <- 2000
cholera_Nreps_global <- 1

MIF: 109.193 sec elapsed
LL: 220.92 sec elapsed


cholera_NpLL <- 1000

MIF: 108.204 sec elapsed
LL: 104.924 sec elapsed

cholera_Np <- 2000
MIF: 224.731 sec elapsed
LL: 104.081 sec elapsed

cholera_Nmif <- 1
cholera_Nreps_global <- 1
MIF: 221.893 sec elapsed
LL: 202.593 sec elapsed

dt_yrs <- 1/365.25 * .1 -> dt_yrs <- 1/365.25 * .2
 -> 54 sec 
 
 So everything is linear. Even the Ninitparameters. We were thinking that we would kep the performance if run like this  but 24 instead of 8
 because 24 core on echopc. But it is longer
 
 
 > ls()
[1] "lik_mf"   "mf"       "run.seed" "t1"       "tt"       "w1"      
> length(mf)
[1] 64
> length(lik_mf)
[1] 30
> head(lik_mf)
     loglik  loglik.se       sigma      betaB       mu_B     thetaA     thetaI
1 -237.7019 0.04213078 0.001608992 0.17923667  81.688783  13.337422 151.756538
2 -236.1299 0.04213198 0.288164695 0.24873217   4.346335   5.908734  21.377492
3 -236.5023 0.04575782 0.908120383 0.02643559  46.770936  70.742361  67.665358
4 -230.8623 0.03220195 0.023837195 1.86893629 105.159318  47.426927 182.303728
5 -232.8750 0.04085305 0.080280824 0.92939249   3.969865 154.411316   7.348437
6 -236.5557 0.03760442 0.842106064 0.06905669 134.392659  88.208192 438.746272
     lambda          r     rhoA      rhoI      std_W    epsilon      Rtot_0
1 2.0247899  8.3812370 4.032279  2.603142 0.02282127 8.96009950 0.145549214
2 0.3785122 54.7960924 1.478095  5.112244 0.09371396 0.03791623 0.266811031
3 8.1003793 12.6783947 7.037789 25.289356 0.09704325 0.10725381 0.070012893
4 1.2650746  0.4149505 1.438987  1.804016 0.08573725 0.10570297 0.283751189
5 1.7092302 13.9455095 1.187094  9.203118 0.09336631 0.04669663 0.576801642
6 5.4451155 12.6580355 3.041725 19.062201 0.10433366 0.04507919 0.002610674
      k      H   D         mu alpha gammaI gammaA          I_0          A_0 B_0
1 10001 746236 214 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0
2 10001 746236 214 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0
3 10001 746236 214 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0
4 10001 746236 214 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0
5 10001 746236 214 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0
6 10001 746236 214 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0
  RI1_0 RI2_0 RI3_0 RA1_0 RA2_0 RA3_0
1     0     0     0     0     0     0
2     0     0     0     0     0     0
3     0     0     0     0     0     0
4     0     0     0     0     0     0
5     0     0     0     0     0     0
6     0     0     0     0     0     0
> lik_mf[which.max(lik_mf$loglik),]
      loglik  loglik.se      sigma    betaB    mu_B   thetaA   thetaI   lambda
56 -230.4325 0.04796441 0.04356808 2.310129 15.1886 111.0602 33.69407 3.290595
          r    rhoA     rhoI      std_W    epsilon    Rtot_0     k      H   D
56 15.63401 1.46142 1.853338 0.08911628 0.05152862 0.5618016 10001 746236 214
           mu alpha gammaI gammaA          I_0          A_0 B_0 RI1_0 RI2_0
56 0.01586626 1.461  73.05  73.05 2.680117e-06 4.020176e-06   0     0     0
   RI3_0 RA1_0 RA2_0 RA3_0
56     0     0     0     0
> 1/0.015
[1] 66.66667
> 1/15.88
[1] 0.06297229
> 1/15.88*365$
+ 1/15.88*365$
> 1/15.88*365$
+ 
> 1/15.88*365
[1] 22.98489


